<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Sistema RH - Login</title>
</head>

<body>
  <h1>Sistema RH</h1>

  <!-- LOGIN -->
  <div id="login-area">
    <button id="btnLoginGoogle">Entrar com Google</button>
  </div>

  <!-- ÁREA LOGADO -->
  <div id="user-area" style="display:none; margin-top:20px;">
    <h2>Dados do Funcionário</h2>

    <table border="1" cellpadding="5">
      <tr><td><b>登録氏名</b></td><td id="d_reg"></td></tr>
      <tr><td><b>在留カード番号</b></td><td id="d_card"></td></tr>
      <tr><td><b>生年月日</b></td><td id="d_birth"></td></tr>
      <tr><td><b>在留資格</b></td><td id="d_status"></td></tr>
      <tr><td><b>在留有効期限</b></td><td id="d_exp"></td></tr>
      <tr><td><b>住所</b></td><td id="d_addr"></td></tr>
      <tr><td><b>連絡先</b></td><td id="d_tel"></td></tr>
      <tr><td><b>入社日</b></td><td id="d_ingresso"></td></tr>
      <tr><td><b>フルネーム</b></td><td id="d_full"></td></tr>
      <tr><td><b>Email</b></td><td id="d_email"></td></tr>
    </table>

    <br>
    <button onclick="location.href='folga.html'">Solicitar Folga</button>
    <br><br>
    <button id="btnLogout">Sair</button>
  </div>

  <!-- FIREBASE -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut }
      from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDTyR6gVjAzC8BA3Y223v6819Pdwjsy8bQ",
      authDomain: "app-rh-hope.firebaseapp.com",
      projectId: "app-rh-hope",
      storageBucket: "app-rh-hope.firebasestorage.app",
      messagingSenderId: "1060676399696",
      appId: "1:1060676399696:web:edb5e407253bd982709755",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const API_USERS = "https://script.google.com/macros/s/AKfycbzgFn3u37vZyrw1JzZJGPa8Ba19SxGqGJBquIUdx_7MqQg-jCqzZfCpv18JXcXk68xJmQ/exec";

    document.getElementById("btnLoginGoogle").onclick = () => signInWithPopup(auth, provider);

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        document.getElementById("login-area").style.display = "none";
        document.getElementById("user-area").style.display = "block";

        const resp = await fetch(API_USERS + "?email=" + user.email);
        const json = await resp.json();

        const d = json.data;

document.getElementById("d_reg").innerHTML      = d["派遣先登録名"];
document.getElementById("d_card").innerHTML     = d["在留カード番号"];
document.getElementById("d_birth").innerHTML    = d["生年月日"];
document.getElementById("d_status").innerHTML   = d["在留資格"];
document.getElementById("d_exp").innerHTML      = d["在留・有効期限"];
document.getElementById("d_addr").innerHTML     = d["住所"];
document.getElementById("d_tel").innerHTML      = d["TEL"];
document.getElementById("d_ingresso").innerHTML = d["INGRESSO"];
document.getElementById("d_full").innerHTML     = d["フルネーム"];
document.getElementById("d_email").innerHTML    = d["EMAIL"];


      } else {
        document.getElementById("login-area").style.display = "block";
        document.getElementById("user-area").style.display = "none";
      }
    });

    document.getElementById("btnLogout").onclick = () => signOut(auth);
  </script>

</body>
</html>
