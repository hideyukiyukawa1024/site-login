<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Login com Google - Sistema RH</title>
</head>

<body>
  <h1>Sistema RH - Login</h1>

  <!-- √Årea de Login -->
  <div id="login-area">
    <button id="btnLoginGoogle">Entrar com Google</button>
  </div>

  <!-- √Årea quando usu√°rio est√° logado -->
  <div id="user-area" style="display:none; margin-top:20px;">
    <h2>Dados do Usu√°rio</h2>
    <p><strong>Nome (Google):</strong> <span id="user-name"></span></p>
    <p><strong>Email (Google):</strong> <span id="user-email"></span></p>
    <img id="user-photo" width="90" style="border-radius:50%;"><br><br>

    <h3>Dados na planilha db-hope</h3>
    <div id="sheet-data">
      <!-- Aqui vamos mostrar os dados da planilha -->
    </div>

    <br>
    <button id="btnLogout">Sair</button>
  </div>

  <script type="module">
    // ============================
    // IMPORTA√á√ïES DO FIREBASE
    // ============================
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut }
      from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

    // ============================
    // CONFIGURA√á√ÉO DO FIREBASE
    // ============================
    const firebaseConfig = {
      apiKey: "AIzaSyDTyR6gVjAzC8BA3Y223v6819Pdwjsy8bQ",
      authDomain: "app-rh-hope.firebaseapp.com",
      projectId: "app-rh-hope",
      storageBucket: "app-rh-hope.firebasestorage.app",
      messagingSenderId: "1060676399696",
      appId: "1:1060676399696:web:edb5e407253bd982709755",
      measurementId: "G-64CT6CWBTW"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // üîó URL da API do Apps Script (COLE A SUA AQUI)
    const API_URL = "https://script.google.com/macros/s/AKfycbzgFn3u37vZyrw1JzZJGPa8Ba19SxGqGJBquIUdx_7MqQg-jCqzZfCpv18JXcXk68xJmQ/exec";

    // ============================
    // LOGIN
    // ============================
    document.getElementById("btnLoginGoogle").onclick = function () {
      signInWithPopup(auth, provider)
        .then((result) => {
          console.log("Usu√°rio logado:", result.user);
        })
        .catch((error) => {
          console.error("Erro no login:", error);
          alert("Erro no login: " + error.message);
        });
    };

    // ============================
    // MONITORAR LOGIN
    // ============================
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        document.getElementById("login-area").style.display = "none";
        document.getElementById("user-area").style.display = "block";

        document.getElementById("user-name").textContent = user.displayName;
        document.getElementById("user-email").textContent = user.email;
        document.getElementById("user-photo").src = user.photoURL || "";

        // Depois do login, busca dados na planilha
        await buscarDadosNaPlanilha(user.email);

      } else {
        document.getElementById("login-area").style.display = "block";
        document.getElementById("user-area").style.display = "none";
        document.getElementById("sheet-data").innerHTML = "";
      }
    });

    // ============================
    // LOGOUT
    // ============================
    document.getElementById("btnLogout").onclick = function () {
      signOut(auth);
    };

    // ============================
    // BUSCAR DADOS NA PLANILHA
    // ============================
    async function buscarDadosNaPlanilha(email) {
      try {
        const resp = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded"
          },
          body: "email=" + encodeURIComponent(email)
        });

        const json = await resp.json();
        console.log("Resposta da planilha:", json);

        const div = document.getElementById("sheet-data");

        if (!json.success) {
          div.innerHTML = `<p style="color:red;">Erro na API: ${json.error}</p>`;
          return;
        }

        if (!json.found) {
          div.innerHTML = `<p style="color:red;">Seu email n√£o est√° cadastrado na planilha db-hope.</p>`;
          return;
        }

        // Montar HTML com alguns campos importantes
        const d = json.data;

        // Aqui voc√™ escolhe o que mostrar (nomes exatos dos cabe√ßalhos)
        // Exemplo de alguns poss√≠veis:
        const camposPrincipais = [
          "No",
          "Âú®Á±ç",
          "Ê¥æÈÅ£ÂÖà‰ºÅÊ•≠„ÉªÂ∑•Â†¥Âêç",
          "EMPRESA",
          "TIPO DE SERVICO",
          "DEPARTAMENTO SECAO",
          "TURNO",
          "TEL",
          "MEIO DE TRANSPORTE",
          "CNH",
          "EMAIL"
        ];

        let html = "<table border='1' cellpadding='5' cellspacing='0'>";

        camposPrincipais.forEach(campo => {
          if (d[campo] !== undefined) {
            html += `
              <tr>
                <td><strong>${campo}</strong></td>
                <td>${d[campo]}</td>
              </tr>
            `;
          }
        });

        html += "</table>";

        div.innerHTML = html;

      } catch (err) {
        console.error("Erro ao buscar dados na planilha:", err);
        document.getElementById("sheet-data").innerHTML =
          `<p style="color:red;">Erro ao consultar a planilha.</p>`;
      }
    }
  </script>
</body>
</html>
